<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">–ö–∞—Ä—Ç–æ—á–∫–∞ –ø–∏—Ç–æ–º—Ü–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        .pet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .pet-name {
            font-size: 32px;
            color: #333;
            margin: 0;
        }
        .pet-price-tag {
            background-color: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        .pet-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }
        .pet-image {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .pet-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        .no-photo {
            width: 100%;
            height: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 16px;
        }
        .pet-info {
            padding: 20px;
        }
        .info-section {
            margin-bottom: 25px;
        }
        .info-section h3 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .info-item {
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        .info-label {
            font-weight: bold;
            color: #666;
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .info-value {
            color: #333;
            font-size: 18px;
        }
        .description {
            background-color: #f0f9f0;
            padding: 25px;
            border-radius: 10px;
            line-height: 1.8;
            color: #444;
        }
        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        .btn-primary:hover {
            background-color: #45a049;
        }
        .btn-secondary {
            background-color: #2196F3;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #1976D2;
        }
        .btn-back {
            background-color: #f5f5f5;
            color: #333;
        }
        .btn-back:hover {
            background-color: #e0e0e0;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
            font-weight: bold;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .icon {
            margin-right: 8px;
            font-size: 18px;
        }

        /* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É */
        .delete-container {
            position: absolute;
            bottom: 30px;
            right: 30px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div th:replace="fragments/navbar"></div>

<div class="container">
    <div class="pet-header">
        <h1 class="pet-name" th:text="${pet.name}">–ò–º—è –ø–∏—Ç–æ–º—Ü–∞</h1>
        <div class="pet-price-tag" th:if="${pet.price != null}">
            <span th:text="${pet.price} + ' —Ä—É–±.'">0 —Ä—É–±.</span>
        </div>
    </div>

    <div class="pet-content">
        <div class="pet-image">
            <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ PetInfo –∏ photoName -->
            <div th:if="${petInfo != null and petInfo.photoName != null and not #strings.isEmpty(petInfo.photoName)}">
                <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è .png -->
                <img th:src="@{'/images/' + ${petInfo.photoName}}"
                     th:alt="${pet.name}"
                     class="pet-photo"
                     onerror="this.onerror=null; this.src='/images/default-pet.jpg'">
            </div>

            <!-- –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ -->
            <div th:if="${petInfo == null or petInfo.photoName == null or #strings.isEmpty(petInfo.photoName)}"
                 class="no-photo">
                –§–æ—Ç–æ –ø–∏—Ç–æ–º—Ü–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            </div>
        </div>

        <div class="pet-info">
            <div class="info-section">
                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">–í–∏–¥</span>
                        <span class="info-value" th:text="${pet.species != null ? pet.species : '–ù–µ —É–∫–∞–∑–∞–Ω'}">–í–∏–¥</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ü–æ—Ä–æ–¥–∞</span>
                        <span class="info-value" th:text="${pet.breed != null ? pet.breed : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}">–ü–æ—Ä–æ–¥–∞</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ü–æ–ª</span>
                        <span class="info-value" th:text="${pet.gender != null ? pet.gender : '–ù–µ —É–∫–∞–∑–∞–Ω'}">–ü–æ–ª</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–í–æ–∑—Ä–∞—Å—Ç</span>
                        <span class="info-value" th:text="${pet.ageMonths != null ? pet.ageMonths + ' –º–µ—Å—è—Ü–µ–≤' : '–ù–µ —É–∫–∞–∑–∞–Ω'}">–í–æ–∑—Ä–∞—Å—Ç</span>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                <div class="description">
                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ PetInfo –µ—Å–ª–∏ –µ—Å—Ç—å -->
                    <div th:if="${petInfo != null and petInfo.description != null and not #strings.isEmpty(petInfo.description)}">
                        <p th:text="${petInfo.description}">
                            –û–ø–∏—Å–∞–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞...
                        </p>
                    </div>

                    <!-- –ï—Å–ª–∏ –Ω–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è –≤ PetInfo -->
                    <div th:unless="${petInfo != null and petInfo.description != null and not #strings.isEmpty(petInfo.description)}">
                        <p>
                            –≠—Ç–æ—Ç –ø–∏—Ç–æ–º–µ—Ü –∏—â–µ—Ç –Ω–æ–≤—ã–π –¥–æ–º. –û–Ω –∑–¥–æ—Ä–æ–≤, –∞–∫—Ç–∏–≤–µ–Ω –∏ –¥—Ä—É–∂–µ–ª—é–±–µ–Ω.
                            –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏. –ü—Ä–∏—É—á–µ–Ω –∫ –ª–æ—Ç–∫—É,
                            –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="actions">
        <a th:href="@{/catalogue}" class="btn btn-back">
            <span class="icon">‚Üê</span> –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É
        </a>
        <!-- –ï–°–õ–ò –ø–∏—Ç–æ–º–µ—Ü –£–ñ–ï –ü–†–û–î–ê–ù (–µ—Å—Ç—å –≤ orders) -->
        <div th:if="${isPetInOrders}">
            <div class="found-home-badge">
                <span class="icon">üè°</span> –ü–∏—Ç–æ–º–µ—Ü —É–∂–µ –Ω–∞—à–µ–ª –¥–æ–º!
            </div>
        </div>
        <!-- –ë–ª–æ–∫ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π -->
        <div sec:authorize="hasRole('CUSTOMER')">
            <!-- –ï–°–õ–ò –ø–∏—Ç–æ–º–µ—Ü –î–û–°–¢–£–ü–ï–ù –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (–Ω–µ—Ç –≤ orders) -->
            <div th:unless="${isPetInOrders}">
                <form th:action="@{/catalogue/pet-card/add-to-cart/{id}(id=${pet.id})}"
                      method="post"
                      style="display: inline;">
                    <button type="submit" class="btn btn-primary">
                        <span class="icon">üõí</span> –ö—É–ø–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É -->
    <div class="delete-container">
        <div sec:authorize="hasRole('MODERATOR')">
            <button class="btn btn-danger" onclick="showDeleteModal()">
                –£–¥–∞–ª–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div id="deleteModal" class="modal-overlay">
    <div class="modal-content">
        <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h2>
        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞ <strong th:text="${pet.name}"></strong>?</p>
        <p><em>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ü–∏—Ç–æ–º–µ—Ü –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</em></p>

        <div class="modal-actions">
            <button class="btn btn-back" onclick="hideDeleteModal()">–û—Ç–º–µ–Ω–∞</button>

            <!-- –§–æ—Ä–º–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è -->
            <form th:action="@{/catalogue/pet-card/remove-pet/{id}(id=${pet.id})}" method="post" style="display: inline;">

                <button type="submit" class="btn btn-danger">
                    –î–∞, —É–¥–∞–ª–∏—Ç—å
                </button>
            </form>
        </div>
    </div>
</div>
<script>
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function showDeleteModal() {
        document.getElementById('deleteModal').style.display = 'flex';
    }

    function hideDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideDeleteModal();
        }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            hideDeleteModal();
        }
    });

    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    document.addEventListener('DOMContentLoaded', function() {
        const deleteForm = document.querySelector('form[th\\:action*="delete"]');
        if (deleteForm) {
            deleteForm.addEventListener('submit', function(e) {
                const confirmed = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.');
                if (!confirmed) {
                    e.preventDefault();
                }
            });
        }
    });
</script>
</body>
</html>